. "$top_srcdir"/library

dtf_prereq pkg installed postgresql-test
dtf_prereq pkg installed make

pgdtf_init_server_test
pgdtf_initdb_and_start

where={{ m.libdir }}/pgsql/test/regress/

rc=false
su - postgres -c "make -C '$where' check" && rc=:

$rc || {
  find "$where" -name 'regression.diffs' | \
    while read line; do
      echo "file $line"
      cat "$line"
    done
}

pgdtf_stop_and_clean

$rc || dtf_fail "testsuite failed"
